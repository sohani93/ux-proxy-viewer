<!DOCTYPE html>
<html>
  <head>
    <title>UX Audit Proxy Viewer</title>
    <!-- Microsoft Clarity script -->
   <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "sdemp81sly");
</script>
    <style>
      html, body { margin: 0; padding: 0; height: 100%; background-color: #f4f4f4; }
      iframe { width: 100%; height: 100vh; border: none; }
    </style>
  </head>
  <body>
    <iframe id="viewer" src=""></iframe>
    
    <!-- This div is where iframe will be dynamically inserted (only if allowed) -->
<div id="iframeContainer"></div>

<!-- Fallback UI - initially hidden -->
<div id="fallbackUI" style="display: none; text-align: center; margin-top: 60px;">
  <h2>‚ö†Ô∏è Site Cannot Be Displayed</h2>
  <p>This website restricted embedding. Here's your reviewed version:</p>

  <img id="fallbackScreenshot" 
       src="https://via.placeholder.com/600x400?text=Loading+Fallback..."
       alt="Fallback heatmap"
       style="max-width: 90%; border-radius: 8px; margin-top: 20px;" />
  
  <br/>
  <a href="#" class="button" target="_blank"
   style="display: inline-block;
          margin-top: 20px;
          **margin-bottom: 60px;**
          padding: 10px 20px;
          background-color: #5e60ce;
          color: white;
          text-decoration: none;
          border-radius: 5px;">
   View Full Audit ‚Üí
</a>
</div>

  <!-- fallback UI will appear when iframe fails -->
<div id="fallbackUI" style="display: none; text-align: center; margin-top: 60px;">
  <h2>‚ö†Ô∏è Site Cannot Be Displayed</h2>
  <p>This website restricted embedding. Here's your reviewed version:</p>

  <div style="display: inline-block; padding-bottom: 80px;"> <!-- ‚úÖ group container -->

    <img id="fallbackScreenshot"
         src="https://via.placeholder.com/600x400?text=Heatmap+Coming+Soon"
         alt="Fallback heatmap"
         style="max-width: 90%; border-radius: 8px; margin-top: 20px;" />

    <br/>

    <a href="#"
       target="_blank"
       style="display: inline-block;
              margin-top: 20px;
              padding: 10px 20px;
              background-color: #5e60ce;
              color: white;
              text-decoration: none;
              border-radius: 5px;">
      View Full Audit ‚Üí
    </a>

  </div>
</div>

  <!-- üíø fallback block (initially hidden) -->
<div id="fallbackUI" style="display:none; padding: 40px; text-align: center;">
  <h2>‚ö†Ô∏è Unable to Display Live Site</h2>
  <p>This website can't be embedded due to security settings.</p>
  <p>Heatmap fallback has been generated instead:</p>

  <!-- Screenshot of the site -->
  <img 
  id="fallbackScreenshot"
  src="https://via.placeholder.com/600x400?text=Fallback+Preview"
  alt="Fallback heatmap"
  style="border: 1px solid #ccc; border-radius: 8px; max-width: 90%; margin: 20px auto;"
/>

  <!-- Optional CTA or redirect button -->
  <a href="https://lovable.report/1234" target="_blank" class="button"
     style="display: inline-block; margin-top: 20px; padding: 10px 20px; background-color: #5e60ce; color: white; text-decoration: none; border-radius: 5px;">
    View Annotated Report ‚Üí
  </a>
</div>
    
<div id="fallbackUI" style="display: none;">
  <p>‚ö†Ô∏è This site could not be embedded. Showing AI fallback view instead.</p>
</div>
    <script>
      const params = new URLSearchParams(window.location.search);
      const url = params.get("url");
      if (url) {
        document.getElementById("viewer").src = decodeURIComponent(url);
      } else {
        document.body.innerHTML = "<h3>No URL provided. Append ?url=https://somesite.com</h3>";
      }
    </script>

  <script>
window.onload = function () {
  const queryParams = new URLSearchParams(window.location.search);
  const targetSite = queryParams.get("url");
  const fallbackImageUrl = queryParams.get("img");

  const container = document.getElementById("iframeContainer");
  const fallback = document.getElementById("fallbackUI");
  const fallbackImg = document.getElementById("fallbackScreenshot");

  function triggerFallback() {
    container.innerHTML = ""; // Remove iframe entirely
    fallback.style.display = "block";
    if (fallbackImageUrl) {
      fallbackImg.src = fallbackImageUrl;
    }
    console.log("‚ö†Ô∏è Fallback UI triggered.");
  }

  try {
    const testIframe = document.createElement('iframe');
    testIframe.src = targetSite;
    testIframe.id = "targetFrame";
    testIframe.style.width = "100%";
    testIframe.style.height = "700px";
    testIframe.onerror = function () {
      triggerFallback(); // Fallback if iframe fails to load
    };

    container.appendChild(testIframe);

    // Run fallback if iframe renders nothing (after 2‚Äì3s)
    setTimeout(() => {
      triggerFallback();
    }, 3000);
  } catch (error) {
    triggerFallback();
  }
};
</script>
  </body>
</html>
